cmake_minimum_required(VERSION 3.16)

project(jetson_adapter LANGUAGES CXX)

# 设置C++标准
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# 查找 OpenCV
find_package(OpenCV REQUIRED)

# 查找 MQTT (Mosquitto)
find_package(PkgConfig REQUIRED)
pkg_check_modules(MOSQUITTO REQUIRED libmosquitto)

# 查找 YAML
find_package(yaml-cpp REQUIRED)

# 查找 Protobuf
find_package(Protobuf REQUIRED)

# 查找所有 common 目录下的子目录源文件
file(GLOB_RECURSE SOURCE_FILES
        "common/stream/*.cpp"
        "common/text/*.cpp"
        "common/utils/*.cpp"
        "extend/*.cpp"
        "extend/*.cc")

# 添加可执行文件
add_executable(jetson_adapter jetson_adapter.cpp ${SOURCE_FILES})

# 包含目录设置
target_include_directories(jetson_adapter PRIVATE
        ${PROJECT_SOURCE_DIR}
        ${OpenCV_INCLUDE_DIRS}
        ${MOSQUITTO_INCLUDE_DIRS}
        ${YAML_CPP_INCLUDE_DIRS}
        ${Protobuf_INCLUDE_DIRS}
)

# 链接库
target_link_libraries(jetson_adapter PRIVATE
        ${OpenCV_LIBRARIES}
        ${MOSQUITTO_LIBRARIES}
        yaml-cpp
        ${Protobuf_LIBRARIES}
)
